<div class="tab attacks" data-group="primary" data-tab="attacks">
  <div class="form-grid">
    <div class="form-group dark-form-group">
      <p class="styled-paragraph"><strong>Complications:</strong> {{system.complications}}</p>
    </div>
    <div class="form-group dark-form-group">
      <p class="styled-paragraph"><strong>Threats:</strong> {{system.threats}}</p>
    </div>
  </div>
  <div class="form-group dark-form-group collapsible">
    <button class="collapsible-button" onclick="toggleCollapse(this)">Attacks and Severe Attacks</button>
    <div class="collapsible-content">
      <p class="styled-paragraph">{{system.severeAttack.description}}</p>
      <div class="button-group">
        <button class="attack-button" onclick="rollAttack()">Attack</button>
        <button class="severe-attack-button" onclick="showSevereAttack()">Severe Attack</button>
      </div>
    </div>
  </div>
  <div class="form-group dark-form-group">
    <label for="system.afflictions" class="centered-label">Afflictions</label>
    <table class="afflictions-table">
      <thead>
        <tr>
          <th>Affliction</th>
        </tr>
      </thead>
      <tbody>
        {{#each system.afflictions}}
          <tr>
            <td>{{this}}</td>
          </tr>
        {{/each}}
      </tbody>
    </table>
    <button class="roll-affliction">Roll Affliction</button>
  </div>
</div>

<script>
function rollAttack() {
  const roll = new Roll('1d6').roll();
  const lowDamage = "{{system.attackRoll.lowDamage}}";
  const mediumDamage = "{{system.attackRoll.mediumDamage}}";
  const highDamage = "{{system.attackRoll.highDamage}}";
  const message = `Roll: ${roll.total}, Low Damage: ${lowDamage}, Medium Damage: ${mediumDamage}, High Damage: ${highDamage}`;
  ChatMessage.create({ content: message });
}

function showSevereAttack() {
  const description = "{{system.severeAttack.description}}";
  const rollFormula = "{{system.severeAttack.rollFormula}}";
  const dialogContent = `
    <p>${description}</p>
    <div>
      <label for="dice-modifier">Dice Modifier:</label>
      <input type="number" id="dice-modifier" name="dice-modifier" value="0"/>
    </div>
    <button onclick="rollSevereAttack('${rollFormula}')">Roll Severe Attack</button>
  `;
  new Dialog({
    title: "Severe Attack",
    content: dialogContent,
    buttons: {}
  }).render(true);
}

function rollSevereAttack(rollFormula) {
  const modifier = parseInt(document.getElementById('dice-modifier').value) || 0;
  const roll = new Roll(`${rollFormula} + ${modifier}d6`).roll();
  ChatMessage.create({ content: `Severe Attack Roll: ${roll.total}` });
}

function toggleCollapse(button) {
  const content = button.nextElementSibling;
  if (content.style.display === "block") {
    content.style.display = "none";
  } else {
    content.style.display = "block";
  }
}
</script>

<style>
.tab.attacks {
  background-color: #1a1a1a;
  color: #f5f5f5;
  padding: 20px;
}

.tab.attacks .form-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 20px;
}

.tab.attacks .form-group {
  margin-bottom: 20px;
  text-align: center;
}

.tab.attacks .dark-form-group {
  border: 1px solid #444;
  padding: 10px;
  border-radius: 4px;
  margin-bottom: 20px;
}

.tab.attacks .dark-form-group label {
  color: #f5f5f5;
  font-weight: bold;
  display: block;
  margin-bottom: 10px;
}

.tab.attacks .styled-paragraph {
  font-size: 1em;
  letter-spacing: 0.05em;
  margin-bottom: 20px;
}

.tab.attacks .button-group {
  display: flex;
  justify-content: center;
  gap: 20px;
  margin-top: 20px;
}

.tab.attacks .attack-button, .tab.attacks .severe-attack-button {
  padding: 10px 20px;
  background-color: #444;
  color: #f5f5f5;
  border: none;
  border-radius: 4px;
  cursor: pointer;
  width: auto; /* Adjust button width */
}

.tab.attacks .attack-button:hover, .tab.attacks .severe-attack-button:hover {
  background-color: #ff5555; /* Red hover color */
}

.tab.attacks .afflictions-table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 10px;
}

.tab.attacks .afflictions-table th, .tab.attacks .afflictions-table td {
  border: 1px solid #444;
  padding: 8px;
  text-align: left;
}

.tab.attacks .afflictions-table th {
  background-color: #444;
  color: #f5f5f5;
}

.tab.attacks .afflictions-table td {
  background-color: #333;
  color: #f5f5f5;
}

.tab.attacks .roll-affliction {
  margin-top: 10px;
  padding: 10px 20px;
  background-color: #444;
  color: #f5f5f5;
  border: none;
  border-radius: 4px;
  cursor: pointer;
}

.tab.attacks .roll-affliction:hover {
  background-color: #ff5555; /* Red hover color */
}

.tab.attacks .collapsible {
  border: 1px solid #444;
  border-radius: 4px;
  padding: 10px;
}

.tab.attacks .collapsible-button {
  background-color: #444;
  color: #f5f5f5;
  border: none;
  border-radius: 4px;
  cursor: pointer;
  padding: 10px 20px;
  width: 100%;
  text-align: left;
}

.tab.attacks .collapsible-button:hover {
  background-color: #ff5555; /* Red hover color */
}

.tab.attacks .collapsible-content {
  display: none;
  padding: 10px;
  border-top: 1px solid #444;
}

form .tab.attacks .form-group {
  display: block;
  margin-bottom: 20px;
}
</style>